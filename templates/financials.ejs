<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Invoice - <%= project.projectName %>
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        body {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: #374151;
            /* Tailwind gray-700 */
            background-color: white;
            position: relative;
        }

        .invoice-container {
            padding: 2.5rem;
            min-height: 297mm;
            /* A4 Height for a full-page feel */
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex-grow: 1;
            /* Pushes footer down */
        }

        .footer-content {
            text-align: center;
            padding-top: 2rem;
            font-size: 12px;
            color: #9CA3AF;
            /* Tailwind gray-400 */
            border-top: 1px solid #E5E7EB;
            /* Tailwind gray-200 */
        }

        /* The "PAID" Stamp Styling */
        .paid-stamp {
            position: absolute;
            bottom: 8rem;
            right: 5rem;
            transform: rotate(-15deg);
            color: #E53E3E;
            /* A strong, clear red */
            border: 4px solid #E53E3E;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            font-size: 3.5rem;
            /* Larger font size */
            font-weight: 700;
            text-transform: uppercase;
            opacity: 0.85;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="invoice-container">

        <% if (isFullPaid) { %>
            <div class="paid-stamp">Paid</div>
            <% } %>

                <main class="main-content">
                    <!-- HEADER: Company Info and Invoice Title -->
                    <header class="flex justify-between items-start pb-8 mb-8 border-b">
                        <div class="flex items-center gap-4">
                            <% if (company.logo) { %>
                                <img src="<%= company.logo %>" alt="<%= company.name %>"
                                    class="h-12 w-12 object-contain">
                                <% } else { %>
                                    <div
                                        class="w-12 h-12 bg-indigo-600 text-white rounded-lg flex items-center justify-center font-bold text-xl">
                                        <%= company.name.charAt(0) %>
                                    </div>
                                    <% } %>
                                        <div>
                                            <h1 class="text-2xl font-bold text-gray-900">
                                                <%= company.name %>
                                            </h1>
                                            <p class="text-sm text-gray-500">Professional Photography Services</p>
                                        </div>
                        </div>
                        <div class="text-right">
                            <h2 class="text-3xl font-semibold uppercase text-gray-400">Invoice</h2>
                            <p class="text-sm text-gray-500 mt-1">Ref: BILL-<%= (paymentId || '' ).slice(0,
                                    8).toUpperCase() %>
                            </p>
                            <p class="text-sm text-gray-500">Invoice Date: <%= date %>
                            </p>

                            <!-- This logic now correctly displays the date ONLY on paid invoices -->
                            <% if (isFullPaid && paid_on_date) { %>
                                <p class="text-sm font-semibold text-green-600 mt-2">✓ Paid on: <%= paid_on_date %>
                                </p>
                                <% } %>
                        </div>
                    </header>

                    <!-- BILLING INFO: From and To -->
                    <section class="grid grid-cols-2 gap-16 mb-12">
                        <div>
                            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3">From</h3>
                            <p class="font-bold text-lg text-gray-800">
                                <%= company.name %>
                            </p>
                            <p class="text-gray-600 whitespace-pre-line mt-1">
                                <%= company.address %>
                            </p>
                            <p class="text-gray-600 mt-2">
                                <%= company.phone %>
                            </p>
                            <p class="text-gray-600">
                                <%= company.email %>
                            </p>
                        </div>
                        <div class="text-right">
                            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3">Prepared For
                            </h3>
                            <p class="font-bold text-lg text-gray-800">
                                <%= customer.name %>
                            </p>
                            <p class="text-gray-600 mt-2">
                                <%= customer.email %>
                            </p>
                            <p class="text-gray-600">
                                <%= customer.phone %>
                            </p>
                        </div>
                    </section>

                    <!-- INVOICE ITEMS TABLE -->
                    <section>
                        <h3 class="section-divider text-xl font-semibold mb-4">Payment Details</h3>
                        <table class="w-full">
                            <thead>
                                <tr class="text-left text-xs uppercase text-gray-500">
                                    <th class="py-3 px-4 bg-slate-50 rounded-l-lg font-semibold">Description</th>
                                    <th class="py-3 px-4 bg-slate-50 rounded-r-lg font-semibold text-right">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="text-gray-700">
                                    <td class="py-4 px-4 border-b border-slate-100">
                                        <%= description || '—' %>
                                    </td>
                                    <td class="py-4 px-4 border-b border-slate-100 text-right font-semibold text-lg">
                                        ₹ <%= Number(amount).toLocaleString('en-IN') %>
                                    </td>
                                </tr>

                                <% if (is_gst) { %>
                                    <!-- GST Section -->
                                    <tr class="text-gray-700 bg-slate-50">
                                        <td class="py-3 px-4 border-b border-slate-100 font-medium">GST (18%)</td>
                                        <td class="py-3 px-4 border-b border-slate-100 text-right font-medium">
                                            ₹ <%= (Number(amount) * 0.18).toLocaleString('en-IN') %>
                                        </td>
                                    </tr>
                                    <tr class="text-gray-900 font-bold">
                                        <td class="py-4 px-4 border-t border-slate-200 text-lg">Total (Incl. GST)</td>
                                        <td class="py-4 px-4 border-t border-slate-200 text-right text-lg">
                                            ₹ <%= (Number(amount) * 1.18).toLocaleString('en-IN') %>
                                        </td>
                                    </tr>
                                    <% } %>
                            </tbody>
                        </table>

                        <!-- GSTIN display below table -->
                        <% if (is_gst && company.gst_number) { %>
                            <p class="text-sm text-gray-600 mt-3">GSTIN: <span class="font-semibold">
                                    <%= company.gst_number %>
                                </span></p>
                            <% } %>
                    </section>

                    </table>
                    </section>

                    <!-- PAYMENT METHODS -->
                    <section class="mt-12">
                        <div class="grid grid-cols-3 gap-8 items-start">
                            <div class="col-span-2">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Payment Information</h3>
                                <div class="grid grid-cols-2 gap-x-8 gap-y-4 text-sm">
                                    <div>
                                        <p class="text-gray-500 mb-1">Bank Name</p>
                                        <p class="font-semibold text-gray-800">
                                            <%= company.bank_name || 'N/A' %>
                                        </p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500 mb-1">Account Number</p>
                                        <p class="font-semibold text-gray-800">
                                            <%= company.bank_account_number || 'N/A' %>
                                        </p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500 mb-1">IFSC Code</p>
                                        <p class="font-semibold text-gray-800">
                                            <%= company.bank_ifsc_code || 'N/A' %>
                                        </p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500 mb-1">UPI ID</p>
                                        <p class="font-semibold text-gray-800">
                                            <%= company.upi_id || 'N/A' %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <% if (company.payment_qr_code_url) { %>
                                <div class="flex flex-col items-center justify-center pt-2">
                                    <p class="text-sm font-medium text-gray-600 mb-2">Scan to Pay</p>
                                    <img src="<%= company.payment_qr_code_url %>" alt="Payment QR Code"
                                        class="w-28 h-28 border-2 border-gray-200 rounded-lg p-1">
                                </div>
                                <% } %>
                        </div>
                    </section>
                </main>

                <!-- FOOTER -->
                <footer class="footer-content">
                    <p>Thank you for your business!</p>
                    <p class="text-gray-400 mt-1">Generated by FirstHash</p>
                </footer>
    </div>
</body>

</html>